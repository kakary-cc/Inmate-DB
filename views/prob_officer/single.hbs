<div class="header-container" id="prob-officer-details" data-prob-officer-id="{{probOfficer.Prob_ID}}">
    <h3>
        Displaying details of #{{probOfficer.Prob_ID}}:
        <span id="First" ondblclick="makeEditable(this)">{{#if probOfficer.First}}{{probOfficer.First}}{{else}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{/if}}</span>,
        <span id="Last" ondblclick="makeEditable(this)">{{#if probOfficer.Last}}{{probOfficer.Last}}{{else}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{/if}}</span>
    </h3>
    <div class="button-container">
        <button onclick="confirmDelete('{{probOfficer.Prob_ID}}')" class="normal-button">Delete</button>
    </div>
</div>
<br>
<table>
    <tr style="background: rgb(200, 200, 200)">
        <th>Street</th>
        <th>City, State</th>
        <th>Zipcode</th>
        <th>Phone</th>
        <th>Email</th>
        <th>Status</th>
    </tr>
    <tr>
        <td><span id="Street" ondblclick="makeEditable(this)">{{#if probOfficer.Street}}{{probOfficer.Street}}{{else}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{/if}}</span></td>
        <td><span id="City" ondblclick="makeEditable(this)">{{#if probOfficer.City}}{{probOfficer.City}}{{else}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{/if}}</span>, <span id="State" ondblclick="makeEditable(this)">{{#if probOfficer.State}}{{probOfficer.State}}{{else}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{/if}}</span></td>
        <td><span id="Zip" ondblclick="makeEditable(this)">{{#if probOfficer.Zip}}{{probOfficer.Zip}}{{else}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{/if}}</span></td>
        <td><span id="Phone" ondblclick="makeEditable(this)">{{#if probOfficer.Phone}}{{probOfficer.Phone}}{{else}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{/if}}</span></td>
        <td><span id="Email" ondblclick="makeEditable(this)">{{#if probOfficer.Email}}{{probOfficer.Email}}{{else}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{/if}}</span></td>
        <td>
            <select id="Status" class="editable-select" onchange="saveData(this)">
                <option value="A" {{#if probOfficer.StatusActive}}selected{{/if}}>Active</option>
                <option value="I" {{#if probOfficer.StatusInactive}}selected{{/if}}>Inactive</option>
            </select>
        </td>
    </tr>
</table>
<div class="button-container">
    <a href="/prob_officer/all" class="normal-button">Back to All Probation Officers</a>
</div>

<script>
function confirmDelete() {
    const probOfficerId = document.querySelector('#prob-officer-details').getAttribute('data-prob-officer-id');
    if (confirm("Are you sure you want to delete this probation officer?")) {
        fetch(`/prob_officer/delete/${probOfficerId}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ id: probOfficerId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Probation officer successfully deleted');
                window.location.href = '/prob_officer/all'; 
            } else {
                alert('Failed to delete. Please try again.');
            }
        })
        .catch(error => {
            console.error('Error deleting probation officer:', error);
            alert('Failed to delete. Please try again.');
        });
    }
}

function toggleEdit() {
    const detailsContainer = document.getElementById('prob-officer-details');
    const editableElements = detailsContainer.querySelectorAll('span, select');

    editableElements.forEach(element => {
        if (element.tagName === 'SPAN') {
            element.setAttribute('data-editable', 'true');
            element.contentEditable = true;
        } else if (element.tagName === 'SELECT') {
            element.disabled = !element.disabled;
        }
    });
}

function makeEditable(element) {
    const probOfficerId = document.querySelector('#prob-officer-details').getAttribute('data-prob-officer-id');
    const isEditable = element.tagName === 'SELECT' ? !element.disabled : element.getAttribute('contentEditable') === 'true';

    if (!isEditable) {
        element.setAttribute('data-editable', 'true');
        element.contentEditable = true;
        element.disabled = false;
        element.focus();
        element.onblur = () => saveData(probOfficerId, element);
        element.onkeypress = function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                element.blur();
            }
        };
    } else {
        element.setAttribute('data-editable', 'false');
        element.contentEditable = false;
        element.disabled = true;
    }
}

document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('select.editable-select').forEach(select => {
        select.setAttribute('data-original', select.value);
    });
    document.querySelectorAll('span').forEach(span => {
        span.ondblclick = function() {
            this.contentEditable = true;
            this.focus();
        };
        span.onblur = function() {
            let cleanText = this.textContent.replace(/\s/g, '');
            this.textContent = cleanText;
            saveData(span);
            this.contentEditable = false;
        };
        span.onkeypress = function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                this.blur();
            }
        };
    });
});

function saveData(probOfficerId, element) {
    const field = element.id;
    const value = element.tagName === 'SELECT' ? element.value : element.textContent.trim();

    if (value !== element.getAttribute('data-original')) {
        fetch(`/prob_officer/update/${field}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ id: probOfficerId, value: value })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                console.log('Update successful');
                element.setAttribute('data-original', value);
            } else {
                console.log('Update failed');
                alert('Failed to update. Please try again.');
            }
        })
        .catch(error => {
            console.error('Error updating:', error);
        });
    } else {
        console.log('No changes detected, update skipped.');
    }
}
</script>

